<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CE — Minimal Estimator Workspace</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-shell">
        <header class="topbar" id="topbar">
            <button class="topbar-toggle" id="navToggle" aria-controls="primaryNav" aria-expanded="false" aria-label="Toggle navigation">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            <div class="topbar-brand">CE</div>
            <nav class="topnav" id="primaryNav" role="navigation">
                <button type="button" class="topnav-item active" data-tab="dashboard" aria-controls="dashboardTab" aria-selected="true">Dashboard</button>
                <button type="button" class="topnav-item" data-tab="estimator" aria-controls="estimatorTab" aria-selected="false">Quick Estimator</button>
                <button type="button" class="topnav-item" data-tab="detailed" aria-controls="detailedTab" aria-selected="false">Detailed Bidding</button>
                <button type="button" class="topnav-item" data-tab="takeoff" aria-controls="takeoffTab" aria-selected="false">Takeoff Manager</button>
                <button type="button" class="topnav-item" data-tab="projects" aria-controls="projectsTab" aria-selected="false">Projects</button>
                <button type="button" class="topnav-item" data-tab="materials" aria-controls="materialsTab" aria-selected="false">Materials</button>
                <button type="button" class="topnav-item" data-tab="settings" aria-controls="settingsTab" aria-selected="false">Settings</button>
            </nav>
            <div class="topbar-actions">
                <button class="icon-btn" id="calculatorBtn" aria-label="Open Calculator">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                </button>
                <button class="btn btn-primary" id="newProjectBtn" type="button">New Project</button>
                <div class="sync-badge" id="syncStatus">
                    <div class="sync-dot"></div>
                    <span>Database synced</span>
                </div>
            </div>
        </header>

        <main class="main-content">
        <section class="header-insights" aria-label="Workflow highlights">
            <article class="insight-card">
                <h2 class="insight-title">Focus your effort</h2>
                <p class="insight-body">Pin critical pursuits, monitor pricing updates, and spotlight risk items before the next stand-up.</p>
            </article>
            <article class="insight-card">
                <h2 class="insight-title">Stay in sync</h2>
                <ul class="insight-list">
                    <li>Capture takeoffs from the field and publish directly to estimates.</li>
                    <li>Share curated pricing feeds with teammates in real time.</li>
                </ul>
            </article>
        </section>

        <div class="content">
                <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content active">
                <div class="grid-4 mb-xl">
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">Total Projects</h3><svg width="24" height="24" fill="none" stroke="var(--primary)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg></div>
                        <p id="totalProjects" class="stat-value text-primary">0</p>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">Total Value</h3><svg width="24" height="24" fill="none" stroke="var(--success)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>
                        <p id="totalValue" class="stat-value text-success">$0</p>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">Under Review</h3><svg width="24" height="24" fill="none" stroke="var(--warning)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></div>
                        <p id="reviewCount" class="stat-value text-warning">0</p>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">Win Rate</h3><svg width="24" height="24" fill="none" stroke="var(--secondary)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>
                        <p id="winRate" class="stat-value text-secondary">0%</p>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="card">
                        <h3 class="card-title mb-lg">Recent Projects</h3>
                        <div id="recentProjectsList" class="space-y-3"></div>
                        <button class="btn btn-secondary mt-md" id="viewAllProjectsBtn">View All</button>
                    </div>
                    <div class="card">
                        <h3 class="card-title mb-lg">Material Price Trends</h3>
                        <canvas id="priceChart" class="chart-sm"></canvas>
                    </div>
                </div>
            </div>

            <!-- Quick Estimator Tab -->
            <div id="estimatorTab" class="tab-content">
                <div class="estimator-grid">
                    <form id="estimatorForm" class="estimator-form">
                        <div class="card estimator-card">
                            <h3 class="card-title">Project Information</h3>
                            <p class="card-subtitle">Capture the essentials and we'll build the first pass of your pricing automatically.</p>
                            <div class="form-group"><label class="form-label" for="projectName">Project Name</label><input type="text" class="form-input" id="projectName" placeholder="Enter project name" required></div>
                            <div class="grid-2 compact-grid">
                                <div class="form-group"><label class="form-label" for="projectType">Project Type</label><select class="form-select" id="projectType" required><option value="">Select type</option><option value="residential">Residential</option><option value="commercial">Commercial</option><option value="industrial">Industrial</option><option value="renovation">Renovation</option></select></div>
                                <div class="form-group"><label class="form-label" for="sqft">Square Footage</label><input type="number" class="form-input" id="sqft" placeholder="Enter sqft" min="0" required></div>
                            </div>
                            <div class="grid-2 compact-grid">
                                <div class="form-group"><label class="form-label" for="floors">Number of Floors</label><input type="number" class="form-input" id="floors" value="1" min="1" required></div>
                                <div class="form-group"><label class="form-label" for="laborCost">Labor Multiplier</label><input type="number" class="form-input" id="laborCost" value="1.5" step="0.1" min="1"></div>
                            </div>
                            <fieldset class="form-group material-fieldset">
                                <legend class="form-label">Foundation Type</legend>
                                <div class="material-grid" role="radiogroup" aria-label="Foundation Type">
                                    <label class="material-card" data-category="foundation" data-material="slab">
                                        <input class="material-input" type="radio" name="foundationMaterial" value="slab">
                                        <span class="material-name">Slab</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="foundation" data-material="crawl">
                                        <input class="material-input" type="radio" name="foundationMaterial" value="crawl">
                                        <span class="material-name">Crawl Space</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="foundation" data-material="basement">
                                        <input class="material-input" type="radio" name="foundationMaterial" value="basement">
                                        <span class="material-name">Basement</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="foundation" data-material="pier">
                                        <input class="material-input" type="radio" name="foundationMaterial" value="pier">
                                        <span class="material-name">Pier &amp; Grade Beam</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="foundation" data-material="mat">
                                        <input class="material-input" type="radio" name="foundationMaterial" value="mat">
                                        <span class="material-name">Mat Foundation</span>
                                        <span class="material-price">--</span>
                                    </label>
                                </div>
                            </fieldset>
                            <fieldset class="form-group material-fieldset">
                                <legend class="form-label">Framing Material</legend>
                                <div class="material-grid" role="radiogroup" aria-label="Framing Material">
                                    <label class="material-card" data-category="framing" data-material="wood">
                                        <input class="material-input" type="radio" name="framingMaterial" value="wood">
                                        <span class="material-name">Wood Stud</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="framing" data-material="steel">
                                        <input class="material-input" type="radio" name="framingMaterial" value="steel">
                                        <span class="material-name">Structural Steel</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="framing" data-material="concrete">
                                        <input class="material-input" type="radio" name="framingMaterial" value="concrete">
                                        <span class="material-name">Cast-in-Place Concrete</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="framing" data-material="massTimber">
                                        <input class="material-input" type="radio" name="framingMaterial" value="massTimber">
                                        <span class="material-name">Mass Timber</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="framing" data-material="coldFormed">
                                        <input class="material-input" type="radio" name="framingMaterial" value="coldFormed">
                                        <span class="material-name">Cold-Formed Steel</span>
                                        <span class="material-price">--</span>
                                    </label>
                                </div>
                            </fieldset>
                            <fieldset class="form-group material-fieldset">
                                <legend class="form-label">Exterior Finish</legend>
                                <div class="material-grid" role="radiogroup" aria-label="Exterior Finish">
                                    <label class="material-card" data-category="exterior" data-material="vinyl">
                                        <input class="material-input" type="radio" name="exteriorMaterial" value="vinyl">
                                        <span class="material-name">Vinyl</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="exterior" data-material="brick">
                                        <input class="material-input" type="radio" name="exteriorMaterial" value="brick">
                                        <span class="material-name">Brick Veneer</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="exterior" data-material="stucco">
                                        <input class="material-input" type="radio" name="exteriorMaterial" value="stucco">
                                        <span class="material-name">Stucco</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="exterior" data-material="stone">
                                        <input class="material-input" type="radio" name="exteriorMaterial" value="stone">
                                        <span class="material-name">Stone Veneer</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="exterior" data-material="fiberCement">
                                        <input class="material-input" type="radio" name="exteriorMaterial" value="fiberCement">
                                        <span class="material-name">Fiber Cement</span>
                                        <span class="material-price">--</span>
                                    </label>
                                    <label class="material-card" data-category="exterior" data-material="curtainWall">
                                        <input class="material-input" type="radio" name="exteriorMaterial" value="curtainWall">
                                        <span class="material-name">Curtain Wall</span>
                                        <span class="material-price">--</span>
                                    </label>
                                </div>
                            </fieldset>
                            <button type="submit" class="btn btn-primary w-full"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>Generate Pricing</button>
                        </form>
                    </div>
                    <div class="estimate-content">
                        <div class="estimate-main">
                            <div class="card" id="quickEstimatorCard">
                                <div class="card-header align-start">
                                    <div>
                                        <h3 class="card-title">Quick Scope Builder</h3>
                                        <p class="card-subtitle">Review generated scopes or add allowances before finalizing totals.</p>
                                    </div>
                                    <button type="button" class="btn btn-secondary" id="addCustomEstimatorBtn">Add Custom Scope</button>
                                </div>
                                <div class="quick-estimator-table-wrapper" id="quickEstimatorTableWrapper">
                                    <table class="worksheet-table quick-estimator-table is-hidden" id="quickEstimatorTable" aria-describedby="quickEstimatorSummary">
                                        <thead>
                                            <tr>
                                                <th scope="col">Scope</th>
                                                <th scope="col">Assembly</th>
                                                <th scope="col">Quantity</th>
                                                <th scope="col">Unit Cost</th>
                                                <th scope="col" class="text-right">Subtotal</th>
                                            </tr>
                                        </thead>
                                        <tbody id="estimatorItemsBody"></tbody>
                                    </table>
                                    <p class="worksheet-empty" id="estimatorEmptyState">Generate pricing to populate the quick estimator or add a custom scope.</p>
                                </div>
                                <div class="quick-estimator-footer" id="quickEstimatorSummary">
                                    <span class="summary-label">Quick estimate subtotal</span>
                                    <span class="summary-value" id="estimatorMaterialsSubtotal">$0</span>
                                </div>
                            </div>
                            <div class="card" id="estimateWorkspace">
                                <div class="card-header align-start">
                                    <div>
                                        <h3 class="card-title">Estimate Worksheet</h3>
                                        <p class="card-subtitle">Fine-tune quantities and pricing before finalizing.</p>
                                    </div>
                                    <div class="worksheet-actions">
                                        <button type="button" class="btn btn-secondary" id="resetWorksheetBtn">Reset</button>
                                        <button type="button" class="btn btn-primary" id="generatePricingBtn">Update Totals</button>
                                    </div>
                                </div>
                                <div class="worksheet-table-wrapper">
                                    <table class="worksheet-table">
                                        <thead>
                                            <tr>
                                                <th scope="col">Scope</th>
                                                <th scope="col">Quantity</th>
                                                <th scope="col">Unit Cost</th>
                                                <th scope="col">Factor</th>
                                                <th scope="col" class="text-right">Subtotal</th>
                                            </tr>
                                        </thead>
                                        <tbody id="estimateWorksheetBody"></tbody>
                                    </table>
                                    <p class="worksheet-empty" id="worksheetEmptyMessage">Select materials and generate pricing to build your worksheet.</p>
                                </div>
                            </div>
                        </div>
                        <aside class="summary-card" id="estimateSummary">
                            <h2 class="summary-title">Estimate Summary</h2>
                            <div class="summary-grid">
                                <div class="summary-item"><div class="summary-label">Materials</div><div class="summary-value" id="materialCost">$0</div></div>
                                <div class="summary-item"><div class="summary-label">Labor</div><div class="summary-value" id="laborCostDisplay">$0</div></div>
                                <div class="summary-item"><div class="summary-label">Labor Multiplier</div><div class="summary-value" id="laborMultiplierDisplay">1.0×</div></div>
                                <div class="summary-item"><div class="summary-label">Cost / Sq Ft</div><div class="summary-value" id="costPerSqFt">$0</div></div>
                                <div class="summary-item summary-item-total"><div class="summary-label">Total</div><div class="summary-value" id="totalCost">$0</div></div>
                            </div>
                            <p class="summary-meta" id="estimateMeta"></p>
                            <button class="btn btn-secondary mt-xl" id="saveProjectBtn">Save Project</button>
                        </aside>
                    </div>
                </div>
            </div>

            <!-- Detailed Bidding Tab -->
            <div id="detailedTab" class="tab-content">
                <div class="detailed-layout">
                    <div class="detailed-main">
                        <div class="card">
                            <h3 class="card-title mb-md">Bid Information</h3>
                            <p class="card-subtitle">Capture client info and key dates so they're always part of the exported package.</p>
                            <details id="bidInfoPanel" class="bid-info-panel" open>
                                <summary id="bidInfoSummary" class="bid-info-summary">
                                    <span class="bid-info-summary-label">Project overview</span>
                                    <span class="bid-info-summary-text" id="bidInfoSummaryText" aria-live="polite">Add project details to build your summary.</span>
                                    <span class="bid-info-summary-icon" aria-hidden="true">▾</span>
                                </summary>
                                <form id="detailedBidForm" class="bid-info-form">
                                    <div class="grid-2 gap-md">
                                        <div class="form-group"><label class="form-label" for="bidProjectName">Project Name</label><input type="text" class="form-input" id="bidProjectName" placeholder="Enter project name" required></div>
                                        <div class="form-group"><label class="form-label" for="clientName">Client Name</label><input type="text" class="form-input" id="clientName" placeholder="Enter client name" required></div>
                                        <div class="form-group"><label class="form-label" for="bidDate">Bid Date</label><input type="date" class="form-input" id="bidDate" required></div>
                                        <div class="form-group"><label class="form-label" for="completionDays">Completion Timeline (Days)</label><input type="number" class="form-input" id="completionDays" placeholder="Enter days" required></div>
                                    </div>
                                </form>
                            </details>
                        </div>
                        <div class="card mt-xl">
                            <div class="card-header line-item-header">
                                <div>
                                    <h3 class="card-title">Line Items</h3>
                                    <p class="card-subtitle">Build your bid with curated assemblies and custom entries.</p>
                                </div>
                                <div class="line-item-tools">
                                    <input type="search" class="form-input" id="lineItemSearch" placeholder="Filter items..." aria-label="Filter line items">
                                    <button class="btn btn-secondary" id="addLineItemBtn">+ Add Item</button>
                                </div>
                                <form id="manualLineItemForm" class="line-item-quick-add">
                                    <input type="text" class="form-input" id="manualCategoryInput" placeholder="Category" required>
                                    <input type="text" class="form-input" id="manualDescriptionInput" placeholder="Description" required>
                                    <input type="number" class="form-input" id="manualQuantityInput" placeholder="Qty" min="0" step="0.01" value="1" required>
                                    <input type="text" class="form-input" id="manualUnitInput" placeholder="Unit" required>
                                    <input type="number" class="form-input" id="manualRateInput" placeholder="Rate" min="0" step="0.01" required>
                                    <button class="btn btn-primary" type="submit">Add Manual Item</button>
                                </form>
                            </div>
                            <div class="line-item-table-wrapper">
                                <div class="line-item-header-row">
                                    <span>Category</span>
                                    <span>Description</span>
                                    <span>Quantity</span>
                                    <span>Unit</span>
                                    <span>Rate</span>
                                    <span class="text-right">Subtotal</span>
                                    <span class="sr-only">Actions</span>
                                </div>
                                <div id="lineItems" class="line-item-body"></div>
                                <p class="line-item-empty" id="lineItemEmptyMessage">Add your first item to start building the bid.</p>
                            </div>
                        </div>
                        <div class="grid-3 mt-xl detailed-adjustments">
                            <div class="card"><h4 class="section-subtitle">Overhead</h4><input type="number" class="form-input" id="overhead" value="10" min="0" step="0.1"><span class="text-muted text-sm">%</span></div>
                            <div class="card"><h4 class="section-subtitle">Profit Margin</h4><input type="number" class="form-input" id="profit" value="15" min="0" step="0.1"><span class="text-muted text-sm">%</span></div>
                            <div class="card"><h4 class="section-subtitle">Contingency</h4><input type="number" class="form-input" id="contingency" value="5" min="0" step="0.1"><span class="text-muted text-sm">%</span></div>
                        </div>
                    </div>
                    <aside class="detailed-sidebar">
                        <div class="summary-card">
                            <h2 class="summary-title">Bid Summary</h2>
                            <div class="summary-grid">
                                <div class="summary-item"><div class="summary-label">Subtotal</div><div class="summary-value" id="bidSubtotal">$0</div></div>
                                <div class="summary-item"><div class="summary-label">Markup</div><div class="summary-value" id="bidMarkup">$0</div></div>
                                <div class="summary-item"><div class="summary-label">Contingency</div><div class="summary-value" id="bidContingency">$0</div></div>
                                <div class="summary-item"><div class="summary-label">Total Bid</div><div class="summary-value" id="bidTotal">$0</div></div>
                            </div>
                            <div class="action-row wrap gap-lg mt-xl">
                                <button class="btn btn-primary" id="exportPdfBtn">Export PDF</button>
                                <button class="btn btn-primary" id="exportXlsxBtn">Export Excel</button>
                                <button class="btn btn-primary" id="exportCsvBtn">Export CSV</button>
                                <button class="btn btn-success ml-auto" id="saveBidBtn">Save Bid</button>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>

            <!-- Projects Tab -->
            <div id="projectsTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Saved Projects</h3>
                        <input type="search" class="form-input max-w-sm" id="projectSearch" placeholder="Search projects...">
                        <button class="btn btn-secondary" id="exportProjectsBtn">Export</button>
                        <button class="btn btn-secondary" id="importProjectsBtn">Import</button>
                        <input type="file" id="importProjectsInput" accept=".json,.csv,.xlsx,.xls" class="hidden-input">
                    </div>
                    <div id="projectsList" class="mt-xl"></div>
                </div>
            </div>

            <!-- Takeoff Manager Tab -->
            <div id="takeoffTab" class="tab-content">
                <div class="takeoff-layout">
                    <section class="card takeoff-drawings">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Drawing Packages</h3>
                                <p class="card-subtitle">Organize sheets and capture quick notes for each set.</p>
                            </div>
                            <button class="btn btn-secondary" id="takeoffAddDrawingBtn" type="button">Add Drawing</button>
                        </div>
                        <form id="takeoffDrawingForm" class="takeoff-form">
                            <div class="takeoff-form-row">
                                <input type="text" class="form-input" id="takeoffDrawingName" placeholder="Sheet name (e.g. A1.01)" required>
                                <input type="text" class="form-input" id="takeoffDrawingTrade" placeholder="Trade">
                            </div>
                            <div class="takeoff-form-row">
                                <input type="text" class="form-input" id="takeoffDrawingFloor" placeholder="Level">
                                <input type="text" class="form-input" id="takeoffDrawingNotes" placeholder="Notes">
                                <button class="btn btn-primary" type="submit">Save</button>
                            </div>
                        </form>
                        <div class="takeoff-filters">
                            <input type="search" class="form-input" id="takeoffSearchInput" placeholder="Filter drawings...">
                            <select id="takeoffSortSelect" class="form-select">
                                <option value="name">Sort by Name</option>
                                <option value="trade">Sort by Trade</option>
                                <option value="floor">Sort by Level</option>
                            </select>
                        </div>
                        <div class="takeoff-drawing-table">
                            <table class="takeoff-table">
                                <thead>
                                    <tr>
                                        <th scope="col">Drawing</th>
                                        <th scope="col">Trade</th>
                                        <th scope="col">Level</th>
                                        <th scope="col">Notes</th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>
                                <tbody id="takeoffDrawingTableBody"></tbody>
                            </table>
                            <p id="takeoffDrawingEmpty" class="takeoff-empty">Add your first drawing to begin tracking takeoffs.</p>
                        </div>
                    </section>
                    <section class="takeoff-workspace">
                        <div class="card takeoff-plan-card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">Measurement Toolkit</h3>
                                    <p id="takeoffActiveMeta" class="takeoff-meta">Select a drawing to begin capturing measurements.</p>
                                </div>
                            </div>
                            <form id="takeoffMeasurementForm" class="takeoff-form measurement-form">
                                <div class="takeoff-form-row">
                                    <input type="text" class="form-input" id="measurementLabelInput" placeholder="Label (e.g. Slab Area)" required>
                                    <select id="measurementModeSelect" class="form-select">
                                        <option value="area">Area</option>
                                        <option value="length">Length</option>
                                        <option value="count">Count</option>
                                    </select>
                                    <input type="number" class="form-input" id="measurementValueInput" placeholder="Value" min="0" step="0.01" required>
                                    <input type="text" class="form-input" id="measurementUnitInput" placeholder="Unit (sq ft, lf, ea)" required>
                                    <button class="btn btn-primary" type="submit">Add</button>
                                </div>
                            </form>
                            <div id="takeoffMeasurementList" class="takeoff-measurements"></div>
                        </div>
                        <div class="card takeoff-summary-card">
                            <h3 class="card-title">Totals</h3>
                            <div id="takeoffSummary" class="takeoff-summary"></div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Materials Tab -->
            <div id="materialsTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Material Price Database</h3>
                        <div class="card-meta">
                            <span>Last updated: <span id="lastUpdate">--</span></span>
                            <span>Last synced: <span id="lastSynced">--</span></span>
                            <span>Last checked: <span id="lastCheck">--</span></span>
                            <span>Next auto-check: <span id="nextSync">--</span></span>
                        </div>
                    </div>
                    <table class="modern-table mt-xl">
                        <thead><tr><th>Material</th><th>Category</th><th>Price</th><th>Unit</th><th>Change</th></tr></thead>
                        <tbody id="materialsTable"></tbody>
                    </table>
                    <div class="source-footer">
                        <h4>Source references</h4>
                        <ul id="sourceList" class="source-list"></ul>
                    </div>
                </div>
                <div class="grid-2 gap-xl mt-xl">
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">Labor Rates</h3></div>
                        <table class="modern-table mt-lg">
                            <thead><tr><th>Trade</th><th>Rate</th><th>Unit</th><th>Burden</th><th>Notes</th></tr></thead>
                            <tbody id="laborTable"></tbody>
                        </table>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">Equipment Rental Rates</h3></div>
                        <table class="modern-table mt-lg">
                            <thead><tr><th>Equipment</th><th>Rate</th><th>Unit</th><th>Notes</th></tr></thead>
                            <tbody id="equipmentTable"></tbody>
                        </table>
                    </div>
                </div>
                <div class="card mt-xl">
                    <div class="card-header"><h3 class="card-title">Regional Cost Multipliers</h3></div>
                    <table class="modern-table mt-lg">
                        <thead><tr><th>Region</th><th>Multiplier</th><th>Major Markets</th><th>Notes</th></tr></thead>
                        <tbody id="regionTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="card">
                    <h3 class="card-title mb-xl">Application Settings</h3>
                    <div class="grid-2 gap-xl">
                        <div>
                            <h4 class="section-subtitle">Database Updates</h4>
                            <div class="form-group"><label class="form-label">Automatic Updates</label><select class="form-select" id="autoUpdate"><option value="enabled">Enabled</option><option value="disabled">Disabled</option></select></div>
                            <div class="form-group"><label class="form-label">Update Frequency</label><select class="form-select" id="updateFrequency"><option value="daily">Daily</option><option value="weekly">Weekly</option><option value="monthly">Monthly</option></select></div>
                            <button class="btn btn-primary" id="checkUpdatesBtn">Check for Updates</button>
                        </div>
                        <div>
                            <h4 class="section-subtitle">Preferences</h4>
                            <div class="form-group"><label class="form-label">Currency</label><select class="form-select"><option>USD ($)</option><option>EUR (€)</option><option>GBP (£)</option></select></div>
                            <div class="form-group"><label class="form-label">Default Tax Rate (%)</label><input type="number" class="form-input" value="8.5" step="0.1"></div>
                            <p class="form-hint">Dark mode is enabled across the workspace for consistent visuals.</p>
                        </div>
                    </div>
                </div>
                <div class="card mt-xl">
                    <h3 class="card-title mb-lg">Firebase Configuration</h3>
                    <p class="card-subtitle mb-lg">Paste the Firebase web app keys from your console to enable Google sign-in.</p>
                    <div class="grid-2 gap-md firebase-config-grid">
                        <div class="form-group"><label class="form-label" for="firebaseApiKey">API Key</label><input type="text" class="form-input" id="firebaseApiKey" autocomplete="off"></div>
                        <div class="form-group"><label class="form-label" for="firebaseAuthDomain">Auth Domain</label><input type="text" class="form-input" id="firebaseAuthDomain" autocomplete="off"></div>
                        <div class="form-group"><label class="form-label" for="firebaseProjectId">Project ID</label><input type="text" class="form-input" id="firebaseProjectId" autocomplete="off"></div>
                        <div class="form-group"><label class="form-label" for="firebaseStorageBucket">Storage Bucket</label><input type="text" class="form-input" id="firebaseStorageBucket" autocomplete="off"></div>
                        <div class="form-group"><label class="form-label" for="firebaseMessagingSenderId">Messaging Sender ID</label><input type="text" class="form-input" id="firebaseMessagingSenderId" autocomplete="off"></div>
                        <div class="form-group"><label class="form-label" for="firebaseAppId">App ID</label><input type="text" class="form-input" id="firebaseAppId" autocomplete="off"></div>
                    </div>
                    <button class="btn btn-primary mt-md" id="saveFirebaseConfigBtn" type="button">Save Firebase Settings</button>
                </div>
                <div class="card mt-xl">
                    <h3 class="card-title mb-lg">Company Information</h3>
                    <div class="grid-2 gap-md">
                        <div class="form-group"><label class="form-label">Company Name</label><input type="text" class="form-input" id="companyName"></div>
                        <div class="form-group"><label class="form-label">Address</label><input type="text" class="form-input" id="companyAddress"></div>
                        <div class="form-group"><label class="form-label">Phone</label><input type="text" class="form-input" id="companyPhone"></div>
                        <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="companyEmail"></div>
                    </div>
                    <button class="btn btn-primary mt-md" id="saveCompanyBtn">Save Company Info</button>
                </div>
                <div class="card mt-xl">
                    <h3 class="card-title mb-lg">Cloud Sync</h3>
                    <p class="card-subtitle mb-lg">Connect Firebase to sync your projects across browsers and devices.</p>
                    <div class="form-group">
                        <label class="form-label">Google Account</label>
                        <div class="sync-id-row">
                            <button class="btn btn-primary" id="googleSignInBtn" type="button">Sign in with Google</button>
                            <button class="btn btn-secondary is-hidden" id="googleSignOutBtn" type="button">Sign out</button>
                        </div>
                        <p class="form-hint" id="authUserDisplay">Not signed in.</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="currentSyncId">Current Sync ID</label>
                        <div class="sync-id-row">
                            <input type="text" class="form-input" id="currentSyncId" readonly>
                            <button class="btn btn-secondary" id="copySyncIdBtn" type="button">Copy</button>
                        </div>
                        <p class="form-hint">Use this ID on another device after configuring Firebase to load the same workspace.</p>
                    </div>
                    <div class="form-group mt-lg">
                        <label class="form-label" for="syncIdInput">Link to an Existing ID</label>
                        <div class="sync-id-row">
                            <input type="text" class="form-input" id="syncIdInput" placeholder="Paste sync ID">
                            <button class="btn btn-primary" id="applySyncIdBtn" type="button">Link Device</button>
                        </div>
                    </div>
                    <div class="cloud-status" id="cloudSyncStatus">Cloud sync offline</div>
                </div>
            </div>
        </div>
    </main>

</div>

<!-- Modals -->
<div class="modal" id="updateModal" role="dialog" aria-modal="true" aria-labelledby="updateTitle" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-header"><h2 class="modal-title" id="updateTitle">Material Cost Update Available</h2><button class="modal-close" id="closeUpdateModal" aria-label="Close update dialog">&times;</button></div>
        <p class="update-meta" id="updateMeta"></p>
        <div class="update-badge">
            <ul class="update-list" id="updateHighlights"></ul>
        </div>
        <p class="update-summary" id="updateSummary">Keep your estimates accurate with the latest market pricing feed.</p>
        <div class="update-actions">
            <button class="btn btn-primary" id="applyUpdateBtn">Apply Update</button>
            <button class="btn btn-secondary" id="laterBtn">Remind Me Later</button>
        </div>
    </div>
</div>

<div class="modal" id="calculatorModal" role="dialog" aria-modal="true" aria-labelledby="calculatorModalTitle" aria-hidden="true">
    <div class="modal-dialog calculator-dialog">
        <div class="modal-header"><h2 class="modal-title" id="calculatorModalTitle">Unit Calculator</h2><button class="modal-close" id="closeCalculatorModal" aria-label="Close calculator">&times;</button></div>
        <div class="calculator-display" id="calculatorDisplay">0</div>
        <div class="mode-switch">
            <button id="modeBasic" class="mode-btn active" data-mode="basic">Basic</button>
            <button id="modeEngineering" class="mode-btn" data-mode="engineering">Engineering</button>
        </div>
        <div class="calculator-grid" id="calculatorGrid">
            <button class="btn btn-secondary" data-value="clear">C</button>
            <button class="btn btn-secondary" data-value="backspace">⌫</button>
            <button class="btn btn-secondary" data-value="%">%</button>
            <button class="btn btn-primary" data-value="/">&divide;</button>
            <button class="btn" data-value="7">7</button>
            <button class="btn" data-value="8">8</button>
            <button class="btn" data-value="9">9</button>
            <button class="btn btn-primary" data-value="*">&times;</button>
            <button class="btn" data-value="4">4</button>
            <button class="btn" data-value="5">5</button>
            <button class="btn" data-value="6">6</button>
            <button class="btn btn-primary" data-value="-">-</button>
            <button class="btn" data-value="1">1</button>
            <button class="btn" data-value="2">2</button>
            <button class="btn" data-value="3">3</button>
            <button class="btn btn-primary" data-value="+">+</button>
            <button class="btn span-2" data-value="0">0</button>
            <button class="btn" data-value=".">.</button>
            <button class="btn btn-primary" data-value="=">=</button>
        </div>
        <div id="engineeringBtns" class="calculator-grid is-hidden mt-md">
            <button class="btn" data-value="sin">sin</button>
            <button class="btn" data-value="cos">cos</button>
            <button class="btn" data-value="tan">tan</button>
            <button class="btn" data-value="sqrt">√</button>
        </div>
        <div class="unit-converter">
            <select id="unitFrom" class="form-select"><option value="ft">Feet</option><option value="in">Inches</option><option value="sqft">Sq. Ft.</option><option value="sqyd">Sq. Yd.</option></select>
            <button class="btn btn-secondary" id="convertUnitBtn">&rarr;</button>
            <select id="unitTo" class="form-select"><option value="in">Inches</option><option value="ft">Feet</option><option value="sqyd">Sq. Yd.</option><option value="sqft">Sq. Ft.</option></select>
        </div>
        <button class="btn btn-success w-full mt-lg" id="useValueBtn">Use Value</button>
    </div>
</div>

<div class="modal" id="newProjectModal" role="dialog" aria-modal="true" aria-labelledby="newProjectModalTitle" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-header"><h2 class="modal-title" id="newProjectModalTitle">Select Estimator Type</h2><button class="modal-close" id="closeNewProjectModal" aria-label="Close new project dialog">&times;</button></div>
        <div class="button-row justify-center gap-md mt-md">
            <button class="btn btn-primary" id="startQuickBtn">Quick Estimator</button>
            <button class="btn btn-secondary" id="startDetailedBtn">Detailed Bidding</button>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer"></div>

    </div>
    <script type="module" src="app.js"></script>
</body>
</html>
